# 牙人软件搜索功能实现与规则

## 前端搜索实现

### 搜索界面组件
- 搜索输入框：`id="search-input"`，接受用户输入搜索关键词
- 搜索按钮：`id="search-button"`，点击触发搜索功能
- 搜索图标：具有`search-icon`类的图标

### 搜索触发方式
1. 点击搜索按钮：`searchButton.addEventListener('click', searchCommission);`
2. 在输入框中按Enter键：
```javascript
searchInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    searchCommission();
  }
});
```

### 前端搜索逻辑（searchCommission函数）
1. 获取搜索文本：`searchInput.value.trim()`
2. 输入验证：如果搜索内容为空，显示提示"请输入搜索内容"
3. 搜索动画效果：
   - 更改搜索按钮文本为"UwU"
   - 添加动画类`.uwu`
   - 5秒后恢复为"U_U"并移除动画类
4. 显示"正在搜索..."提示
5. 通过`window.api.getCommissions()`从后端获取所有委托数据
6. 搜索匹配逻辑：
   - 首先尝试按ID精确搜索
   - 如果找到匹配ID的委托，直接显示详情
   - 否则按标题进行模糊搜索（不区分大小写）
7. 搜索结果处理：
   - 对标题匹配结果应用地区筛选（使用`filterCommissionsByLocation`函数）
   - 如果有匹配结果，调用`renderCommissionsList`函数显示结果
   - 如果当前不在首页，切换到首页
   - 显示搜索成功提示："找到 X 个匹配的委托"
   - 无匹配结果时显示相应提示

## 后端搜索实现

### 委托获取功能（get-commissions）
1. 设备ID验证：`getDeviceId()`
2. 频率限制检查：`isRateLimited(deviceId)`
3. 获取委托列表：`store.get('commissions')`
4. 处理委托排序权重：
   - 根据委托的赞数（likes）计算权重
   - 考虑委托的展示次数（今日展示超过2次权重清零）
5. 委托排序规则：
   - 15%概率使用权重排序（基于赞数）
   - 其余情况按时间倒序排序
6. 更新委托展示记录
7. 返回处理后的委托列表

### 委托搜索功能（search-commission）
1. 设备ID验证：`getDeviceId()`
2. 频率限制检查：`isRateLimited(deviceId)`
3. 根据ID查找委托：`commissions.find(comm => comm.id === id)`
4. 返回匹配的委托数据

## 搜索样式与特效

### 标准搜索样式
- 搜索框采用圆角设计，带有动画效果
- 按钮使用圆形设计，有悬停和点击特效
- 搜索过程中显示动画效果

### 文言文模式特殊样式
- 使用中国古典风格设计
- 特殊字体：`'FangSong', 'STFangsong', serif`
- 搜索框和按钮使用特殊的边框和颜色
- 额外的装饰元素和动画效果

## 搜索限制规则

1. 频率限制：通过`isRateLimited`函数检查，避免频繁请求
2. 内容审核：搜索内容可能受到恶意内容检查
3. 单次搜索仅支持一种匹配方式：
   - 优先按ID精确匹配
   - 其次按标题模糊匹配（不区分大小写）
4. 搜索结果受地区筛选影响，可能需要切换到"全国"筛选才能看到更多结果 